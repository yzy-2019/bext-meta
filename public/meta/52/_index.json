{"versions":[{"hash":"c0e2117631535c81aa4e64560ba58c854f782fbc","date":1645244136,"message":"首次提交","author_name":"Lemon399","author_email":"1446744399@qq.com","version":"1"}],"meta":{"type":"javascript","name":"网页元素标识","version":"1","synopsis":"生成广告标记规则","tags":["工具脚本","其他脚本"],"detail":"<p>搬运自 <a rel=\"noopener noreferrer\" href=\"http://via-app.cn/#/pluginDetail/52\">Via 轻插件</a> ，作者 <a rel=\"noopener noreferrer\" href=\"http://via-app.cn/#/user/28\">Sky</a></p><p>对原脚本进行如下修改 ：</p><ul><li>适配本站安装选项</li></ul><p>以下是原版介绍，有删改：</p><p><br></p><h2><span style=\"background-color: rgb(250, 204, 204);\"> </span> 脚本作用：</h2><p><br></p><p>     用脚本实现了一个类似于Adblock Plus那样可以实时调试标记网页（广告）元素的工具，可生成相应的Adblock Plus规则。</p><p><br></p><p>       您可以修改代码安装选项，来调整\"打开调试\"按钮以及工具栏的默认位置，以防被遮挡。</p><p><br></p><p>       现在，您可以通过点击\"增目标\"按钮连续标记多个元素。注意，点击\"结束调试\"会清空正在标记的目标列表。</p><p><br></p><h2><span style=\"background-color: rgb(250, 204, 204);\"> </span> 测试链接</h2><p><br></p><p><a style=\"color: rgb(240, 102, 102);\" rel=\"noopener noreferrer\" href=\"https://m.bilibili.com/video/BV1NZ4y1j7nw\"><strong>点击进入测试网页</strong></a></p><p><br></p><h2><span style=\"background-color: rgb(250, 204, 204);\"> </span> 使用说明：</h2><p><br></p><h3>第1步. 把脚本跑起来</h3><p><br></p><p>安装脚本后多次尝试刷新网页，直到网页右下角出现\"<strong style=\"color: rgb(240, 102, 102);\">打开调试</strong>\"按钮，出现按钮表示脚本开始运行。（该按钮可拖动到别的位置哦）</p><p><br></p><h3>第2步. 长按需要标记的元素</h3><p><br></p><p>出现长按菜单或者选定菜单，甚至什么都没发生<strong style=\"color: rgb(240, 102, 102);\">都是正常的</strong>，此时已经在后台完成了选定，请点击右下角\"打开调试\"按钮。</p><p><br></p><h3>第3步. 调整你的选定目标</h3><p><br></p><p>选定的目标会被红色粗线框框住，点击\"扩大范围\"或者\"缩小范围\"，直到红框<strong style=\"color: rgb(240, 102, 102);\">刚好框住目标元素或者稍大一点点的范围</strong>。若发现工具栏挡住了想要标记的元素，可以点击右边的\"↑\"按钮，把工具栏调到页面顶部。</p><p><br></p><p>如果发现红框<strong style=\"color: rgb(240, 102, 102);\">框住了别的东西</strong>，请点击右下角的\"结束调试\"按钮，并回到上面的<strong style=\"color: rgb(240, 102, 102);\">第2步</strong>重试。</p><p><br></p><h3>第4步. (可选)连续标记更多目标</h3><p><br></p><p>点击\"增目标\"按钮后会收起工具栏，此时已标记的目标<strong style=\"color: rgb(240, 102, 102);\">已被记录下来</strong>。标记下一个目标的方法同<strong style=\"color: rgb(240, 102, 102);\">第2和第3步</strong>。若要从组合规则中删除最近一个标记的目标可点击\"减目标\"按钮。</p><p><br></p><h3>第5步. 添加广告标记规则</h3><p><br></p><p>都选好之后，点击\"导出规则\"按钮即可一键将拦截规则添加到via中。其他浏览器点击后会将规则复制到剪切板，需要自行添加为浏览器广告拦截规则。</p><p><br></p><h2><span style=\"background-color: rgb(250, 204, 204);\"> </span> 免责声明：</h2><p><br></p><ul><li>此插件仅适用于个人技术研究学习，请勿商用。</li><li>出现任何法律纠纷，与作者无关。</li></ul><p><br></p><p><br></p>","source":"/*\n * @name: 网页元素标识\n * @Author: Sky\n * @version: 2.2\n * @description: 生成广告标记规则\n * @include: *\n * @createTime: 2020-6-3 02:30\n * @updateTime: 2020-7-19 01:05\n */\nimport config from '@bext/config';\n(function(){const\n/* 等号后的数可供修改\n   ↓ \"开始调试\"按钮 ↓ */\nlenToR = config.lenToR, /*到右边距离(px)*/\nlenToB = config.lenToB, /*到底部距离(px)*/\n/* ↓ 主菜单 ↓ 1为是 0为否 */\ntMenu = config.tMenu ? 1 : 0, /*是否默认在顶部*/\nexitC = config.exitC ? 1 : 0, /*结束调试是否需要确认*/\n/*－－－－以下勿改－－－－*/\nkey=encodeURIComponent('网页元素标识:执行判断');if(window[key]){return;}try{window[key]=true;let tmpRule=[],targtEle=null,tIndex=0,preRst=[],needC=false,undo=false;const borderRule='{border:5px solid red!important}',d=document,open=d.createElement(\"div\"),menu=d.createElement(\"div\");open.style=`position:fixed!important;right:${lenToR}px;bottom:${lenToB}px;background:black;color:snow;line-height:1;padding:7px;user-select:none;touch-action:none`;open.className='e_i_sky';open.innerText='打开调试';d.body.appendChild(open);menu.style='width:100%;position:fixed!important;bottom:0;left:0;background:beige;display:none';menu.className='e_i_sky';menu.innerHTML='<style>.e_i_sky{z-index:999999;font-size:15px;white-space:nowrap}.e_i_sky>div{height:35px;display:flex}.e_i_sky::-webkit-scrollbar{display:none}button.e_i_sky{width:25%;color:#662}button.e_i_sky:disabled{color:#5555}</style><style id=\"elemnt_idntify_css\"></style><div><div class=\"e_i_sky\"id=\"elemnt_idntify_rule\" style=\"width:90%;line-height:32px;padding:0 5px;border:1px solid gray;overflow:auto\"></div><button class=\"e_i_sky\"id=\"elemnt_idntify_more\">增目标</button><button class=\"e_i_sky\"id=\"elemnt_idntify_less\"></button><button class=\"e_i_sky\"id=\"elemnt_idntify_switchTB\"style=\"width:50px\">↑</button></div><div><button class=\"e_i_sky\"id=\"elemnt_idntify_enlarge\">扩大范围</button><button class=\"e_i_sky\"id=\"elemnt_idntify_shrink\">缩小范围</button><button class=\"e_i_sky\"id=\"elemnt_idntify_outRule\">导出规则</button><button class=\"e_i_sky\"id=\"elemnt_idntify_close\">结束调试</button></div>';d.body.appendChild(menu);const css=d.getElementById('elemnt_idntify_css'),ruleInfo=d.getElementById('elemnt_idntify_rule'),more=d.getElementById('elemnt_idntify_more'),less=d.getElementById('elemnt_idntify_less'),switchTB=d.getElementById('elemnt_idntify_switchTB'),enlarge=d.getElementById('elemnt_idntify_enlarge'),shrink=d.getElementById('elemnt_idntify_shrink'),outRule=d.getElementById('elemnt_idntify_outRule'),close=d.getElementById('elemnt_idntify_close');function findRule(e){tmpRule=[];for(;e&&e.tagName!='BODY';e=e.parentElement){if(e.id!=''){tmpRule.push(e.tagName+'#'+e.id);}else if(e.className!=''){tmpRule.push(e.tagName+'.'+e.className.replace(/ /g,'.'));}}}function usualRefresh(){shrink.disabled=tIndex<=0;enlarge.disabled=tIndex>=tmpRule.length-1;if(location.hostname!=''){if(tmpRule.length>0){outRule.disabled=false;ruleInfo.innerText='规则：'+location.hostname+'##'+(preRst.length>0?preRst.join()+',':'')+tmpRule[tIndex];css.innerText=(preRst.length>0?preRst.join()+',':'')+tmpRule[tIndex]+borderRule;needC=true;}else{typeof(window.via)==\"object\"&&window.via.toast('提示:先长按目标再点开始调试');outRule.disabled=true;ruleInfo.innerText='未选目标或无法标识';css.innerText=preRst.length>0?preRst.join()+borderRule:'';if(preRst.length>0){needC=true;less.disabled=false;less.innerText='撤销';undo=true;}}}else{outRule.disabled=true;ruleInfo.innerText='当前域名获取失败';needC=false;}}function copy2clip(t){const a=d.createElement(\"input\");a.style='position:fixed;top:-99px;opacity:0';a.value=t;d.body.appendChild(a);a.select();d.execCommand(\"copy\");d.body.removeChild(a);alert('成功复制Adblock规则，请自行添加为浏览器广告拦截规则。');}function hideMenu(){open.style.display='block';menu.style.display='none';css.innerText='';targtEle=null;}open.onclick=function(){less.innerText='减目标';undo=false;menu.style.display='block';open.style.display='none';findRule(targtEle);tIndex=0;less.disabled=tmpRule.length<1&&preRst.length<1;usualRefresh();};open.addEventListener('touchmove',function(e){open.style.right=open.style.bottom='';open.style.left=(e.touches[0].clientX-25)+'px';open.style.top=(e.touches[0].clientY-10)+'px';},{'passive':true});close.onclick=function(){if(exitC&&needC&&!confirm(\"退出调试将清空当前规则，是否确认？\")){return;}preRst=[];hideMenu();};more.onclick=function(){tmpRule[tIndex]&&preRst.push(tmpRule[tIndex]);hideMenu();};less.onclick=function(){targtEle=null;enlarge.disabled=true;shrink.disabled=true;if(undo){tmpRule=[];undo=false;less.innerText='减目标';}else if(tmpRule.length>0){tmpRule=[];}else{preRst.pop();}if(preRst.length>0){ruleInfo.innerText='规则：'+location.hostname+'##'+preRst.join();css.innerText=preRst.join()+borderRule;needC=true;outRule.disabled=false;}else{ruleInfo.innerText='未选目标或无法标识';css.innerText='';less.disabled=true;needC=false;outRule.disabled=true;}};enlarge.onclick=function(){tIndex++;usualRefresh();};shrink.onclick=function(){tIndex--;usualRefresh();};outRule.onclick=function(){const r=preRst.length>0?preRst.join()+(tmpRule.length>0?','+tmpRule[tIndex]:''):tmpRule[tIndex];if(typeof(window.via)==\"object\"){window.via.record(location.hostname,r);window.via.toast('导出成功，刷新生效');}else{copy2clip(location.hostname+'##'+r);}};switchTB.onclick=function(){if(menu.style.top==''){menu.style.top='0';menu.style.bottom='';switchTB.innerText='↓';}else{menu.style.top='';menu.style.bottom='0';switchTB.innerText='↑';}};tMenu&&switchTB.onclick();d.addEventListener('touchstart',function(e){e.target.className!='e_i_sky'&&(targtEle=e.target);},{'passive':true,'capture':true});}catch(err){console.log('网页元素标识：',err);}})();","configSchema":{"type":"object","properties":{"lenToR":{"type":"number","title":"到右边距离(px)","enumDesc":""},"lenToB":{"type":"number","title":"到底部距离(px)"},"tMenu":{"type":"boolean","title":"默认在顶部"},"exitC":{"type":"boolean","title":"结束调试需要确认"}},"required":["lenToR","lenToB","tMenu","exitC"]},"defaultConfig":{"lenToR":20,"lenToB":15,"tMenu":false,"exitC":true}},"hash":"c0e2117631535c81aa4e64560ba58c854f782fbc"}