{"type":"javascript","name":"小说阅读模式","version":"3","synopsis":"小说阅读模式","tags":["阅读脚本"],"detail":"<p>搬运自 <a href=\"http://via-app.cn/#/pluginDetail/15\" rel=\"noopener noreferrer\">Via 轻插件</a> ，作者 <a href=\"http://via-app.cn/#/user/10\" rel=\"noopener noreferrer\">达蒙山</a></p><p><br></p><p>对原脚本进行如下修改 ：</p><ul><li>修复运行时机问题</li><li>适配本站安装选项</li></ul><p><br></p><p>以下是原版介绍 ：</p><p><br></p><p>按钮开关的标志是“[Ξ]”。手指上滑屏幕隐藏、下滑屏幕则显示，进入阅读模式后的设置按钮“M”同。</p><p><br></p><p><a href=\"https://m.biquge.info/0_580/278784.html\" rel=\"noopener noreferrer\" style=\"background-color: transparent; color: rgb(240, 102, 102);\">测试链接</a></p><p><br></p><p>由于via浏览器对于js脚本有点兼容性问题，导致部分网法无法正常使用这个脚本插件。通常这个网页也无法使用其他脚本插件。如果是这样的网页，在此深表遗憾！</p><p><br></p><p>已经有几个网友反馈了，测试链接无法使用这个脚本，对于兼容性问题暂时解决不了。如果是这个脚本引起倒可以尝试解决，遗憾的是别的浏览器却可以正常使用</p><p><br></p><p>（注：这边测试可以用）</p>","source":"/*\n * @name: 小说阅读模式\n * @Author: 酷安@达蒙山\n * @version: 191014.16\n * @description: 小说阅读模式\n * @include: *\n * @createTime: 2019-10-14 00:00:00\n * @updateTime: 2019-10-14 16:00:00\n */\nimport { runAt } from '@bext/util';\nimport config from '@bext/config';\nrunAt('document-idle',() => {\n!function () {\n    /*《小说阅读模式v3.3》\n    【使用说明】：\n    按钮开关“[Ξ]”是上滑隐藏、下滑显示的，进入阅读模式后的设置按钮“M”同。\n    【参考】：阅读模式→酷安 fangsiyuan《纯文本阅读模式》；\n    按钮隐藏→酷安 谷花泰《仿酷安回到顶部/底部（增强版）》；\n    主题→话本小说网;\n    酷安 石头VS影子 提供历史记录方法……\n    感谢评论区的建议反馈*/\n    var zhdx = config.zhdx;/*20为字体初始大小*/\n    var zhcz = config.zhcz;/*6为字行差值，该值与字体大小之和作为行高*/\n    var zhbj = config.zhbj;/*4为显示边距*/\n    var djkh = config.djkh;/*段落之间是否空行，0否1是*/\n    var cszt = config.cszt;/*初始主题，主题格式：背景色-字体颜色。单独颜色值则为背景色且字体为黑色*/\n    var ztss = config.ztss.join(';');/*本脚本所有主题集，主题之间“;”隔开*/\n    var $ = function (e) { return document.querySelector(e) }, ydcss = \"display:none;text-align:center !important;font-size:20px;width:28px;height:28px;line-height:28px;text-align:center;float:right;position:fixed;right:10px;top:70%;color:#000;opacity:0.8;background:#e3edcd;cursor:pointer;position:fixed !important;z-index:9999999999 !important;box-shadow:0px 1px 1px #000;border-radius:50%;\";\n    if (!$(\"#txtyd\")) {\n        var ydan = document.createElement(\"span\");\n        ydan.id = \"txtyd\";\n        ydan.innerHTML = \"[\\u039e]\";\n        ydan.style.cssText = ydcss;\n        ydan.addEventListener(\"click\", function () { jryd() });\n        $(\"body\").appendChild(ydan);\n    }\n    var hdy1, hdy2; document.addEventListener(\"touchstart\", function (e) {\n        hdy1 = e.changedTouches[0].clientY\n    });\n    document.addEventListener(\"touchmove\", function (e) {\n        hdy2 = e.changedTouches[0].clientY; $(\"#txtyd\").style.display = hdy2 - hdy1 > 0 ? \"block\" : \"none\"\n    });\n    function jryd() {\n        var wybm = $(\"head\").innerHTML.match(/<meta.*charset.*?=.*?([^\"]+).*?>/i)[1], wyt = '<html><head><meta charset=\"' + wybm + '\"><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0\"><style type=\"text/css\">body{text-align:center;word-wrap:break-word;}#xsxs p{padding:0px ' + zhbj + 'px;text-align:justify;margin:0;text-indent:2em;}.wbt{font-weight:bold;}</style><title></title><script>var $=function(e){return document.querySelector(e)},dqurl=\"' + location.href + '\",ksqy=\"' + document.documentElement.clientHeight + '\",xsztys=\"' + ztss + '\",mrzt=\"' + cszt + '\",pbkh=\"' + djkh + '\";</script></head><body><div><iframe hidden></iframe></div><div id=\"xssj\" style=\"width:100%;height:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;\"></div><div id=\"xsxs\"></div><br><script>var nexturl=dqurl,nextt=\"\",xsnr,tcdzt,tztdx,tzthg,fysz,khwb;pbkh?khwb=\"</p><br><p>\":khwb=\"</p><p>\";function szztdx(e){$(\"body\").style.fontSize=e+\"px\";tztdx=e;tzthg=e*1+' + zhcz + ';fysz=ksqy-tzthg;$(\"body\").style.lineHeight=tzthg+\"px\"};szztdx(\"' + zhdx + '\");xstxt(dqurl);function xstxt(e){dqurl=e;var t=new XMLHttpRequest;t.open(\"get\",e,true),t.overrideMimeType(\"text/html;charset=' + wybm + '\"),t.onreadystatechange=function(){4==t.readyState&&200==t.status&&($(\"#xssj\").innerHTML=t.responseText.replace(/^\\\\s+|\\\\s+$/g,\"\").replace(/<!--.*?-->/g,\"\").replace(/>\\\\s+?</g,\"><\").replace(/<style[\\\\s\\\\S]*?<\\\\/style>/ig,\"\").replace(/<script[\\\\s\\\\S]*?<\\\\/script>/ig,\"\").replace(/<iframe[\\\\s\\\\S]*?<\\\\/iframe>/ig,\"\").match(/<body[\\\\s\\\\S]*<\\\\/body>/i),nextt=t.responseText.match(/<title>([\\\\s\\\\S]*)<\\\\/title>/i)[1],zltxt())},t.send()}function zltxt(){function e(e){e.style.display=\"none\"}function n(){for(var n=[\"div\",\"span\",\"p\"],t=0;t<n.length;t++){var r=s.querySelectorAll(n[t]);if(r.length>0)for(var o=0;o<r.length;o++)r[o].innerText.replace(/\\\\s+/g,\"\").length<8&&e(r[o])}}function t(n){var t=s.querySelectorAll(n);if(t.length>0)for(var r=0;r<t.length;r++)e(t[r])}function r(n){s.querySelector(n)&&e(s.querySelector(n))}function o(){xsnr=(\"\\\\n\\\\n\"+xsnr).replace(/\\\\r|\\\\n/g,\"\\\\n\\\\n\").replace(/\\\\n\\\\s+/g,khwb),window.screen.height>=document.documentElement.scrollHeight&&zstxt()}var s=$(\"#xssj\"),u=s.querySelectorAll(\"a\"),l=u.length,x=/\\u4e0b\\u4e00\\u9875|\\u4e0b\\u9875|\\u4e0b\\u8282|\\u4e0b\\u4e00\\u9801|\\u4e0b\\u9801|\\u4e0b\\u4e00\\u7ae0|\\u4e0b\\u7ae0/;if(l>0)for(var c=l-1;c>=0;c--){var i=u[c],a=i.innerText,f=i.href;if(x.test(a)&&-1==f.indexOf(\"#\")){nexturl=f;break}nexturl=\"\"}!function(){r(\"#foot\"),t(\"footer\"),r(\"#footer\"),r(\".footer\"),t(\"iframe\"),t(\"form\"),t(\"input\"),t(\"table\"),t(\"tbody\"),t(\"tr\"),t(\"td\"),t(\"ul\"),t(\"li\"),t(\"img\"),t(\"font\"),t(\"b\"),t(\"a\")}(),$(\"#xssj #chaptercontent\")?(r(\"#cambrian0\"),xsnr=$(\"#xssj #chaptercontent\").innerText,o()):$(\"#xssj #nr\")?(xsnr=$(\"#xssj #nr\").innerText,o()):$(\"#xssj #content\")?(xsnr=$(\"#xssj #content\").innerText,o()):$(\"#xssj .content\")?(xsnr=$(\"#xssj .content\").innerText,o()):$(\"#xssj #novelcontent\")?(xsnr=$(\"#xssj #novelcontent\").innerText,o()):(n(),n(),xsnr=s.innerText,o())}function zstxt(){dqurl!=location.href&&history.pushState(null,nextt,dqurl);document.title=nextt;var t=\"<br><br><div class=\\'wbt\\'>END</div><br>\";$(\"#xsxs\").innerHTML+=t.replace(/END/,nextt)+\"<p>\"+xsnr+\"</p>\",\"\"!=nexturl?setTimeout(\"xstxt(nexturl)\",2e3):($(\"#xsxs\").innerHTML+=t,dqurl=\"\")}document.addEventListener(\"scroll\",dddb);function dddb(){var e=document.documentElement.scrollTop||$(\"body\").scrollTop;window.screen.height<document.documentElement.scrollHeight&&e+2*window.screen.height>document.documentElement.scrollHeight&&dqurl!=nexturl&&zstxt()}</script><span id=\"txtcd\" style=\"top:80%;\">M</span><div id=\"szcsp\" style=\"color:rgb(0,0,0);font-size:24px;line-height:24px;opacity:1;background:rgb(255,255,255);cursor:pointer;position:fixed;bottom:5%;left:5%;right:5%;margin-top:auto;z-index:9999;border:1px solid rgb(197,197,197);border-radius:5px;-webkit-tap-highlight-color:rgba(0,0,0,0);display:none;\"><div id=\"szcsp2\" style=\"margin:8px;padding:8px;text-align:center;\"><p><span id=\"csztjx\">\\u3000A-\\u3000</span>\\u3000<span id=\"csztzd\">\\u3000A+\\u3000</span></p><p id=\"cszt\"></p><p><span onclick=\"location.reload();window.scrollTo(0,0);\">\\u9000\\u51fa\\u9605\\u8bfb\\u6a21\\u5f0f</span></p></div></div><style type=\"text/css\">#szcsp2 span{display:inline-block;margin:4px;padding:4px;border:1px solid #c5c5c5;border-radius:5px;}#szcsp2 p{margin:4px;}img{display:none!important;}#txtcd{' + ydcss + '}</style></body></html>'; var newy = window.open('', '_self'); newy.opener = null; newy.document.write(wyt); newy.document.close(); var cpfy = document.createElement(\"script\"); cpfy.innerHTML = '$(\"#xsxs\").addEventListener(\"click\",function(e){e.clientY<window.screen.availHeight/2?window.scrollBy(0,-fysz):(window.scrollBy(0,fysz),yctcd())});document.addEventListener(\"touchstart\",function(e){startY=e.changedTouches[0].clientY});document.addEventListener(\"touchmove\",function(e){endY=e.changedTouches[0].clientY,endY-startY>0?($(\"#txtcd\").style.display=\"block\",tcdzt=1):yctcd()});function yctcd(){\"1\"==tcdzt&&($(\"#txtcd\").style.display=\"none\",$(\"#szcsp\").style.display=\"none\",tcdzt=0)};$(\"#txtcd\").addEventListener(\"click\",function(){$(\"#szcsp\").style.display=\"block\";tcdzt=1}),$(\"#csztjx\").addEventListener(\"click\",function(){var t=tztdx-1;t>9&&szztdx(t)}),$(\"#csztzd\").addEventListener(\"click\",function(){var t=1*tztdx+1;t<41&&szztdx(t)});cjztan();szzt(mrzt);function cjztan(){for(var t=xsztys.split(\";\"),e=0;e<t.length;e++){var n=document.createElement(\"span\");n.innerHTML=\"\\u3000\",n.style.backgroundColor=t[e].split(\"-\")[0],n.setAttribute(\"ysz\",t[e]),n.onclick=function(){var t=this.getAttribute(\"ysz\");szzt(t)},$(\"#cszt\").appendChild(n)}}function szzt(o){var t=o.split(\"-\");$(\"body\").style.backgroundColor=t[0],void 0==t[1]?$(\"body\").style.color=\"#000\":$(\"body\").style.color=t[1]}';\n        $(\"body\").appendChild(cpfy)\n    }\n}();\n});","configSchema":{"type":"object","properties":{"zhdx":{"type":"number","title":"字体初始大小"},"zhcz":{"type":"number","title":"字行差值","description":"该值与字体大小之和作为行高"},"zhbj":{"type":"number","title":"显示边距"},"djkh":{"type":"boolean","title":"段落之间空行"},"cszt":{"type":"string","title":"初始主题","pattern":"^#?[0-9a-zA-Z\\(\\)\\.,% ]{3,}(-#?[0-9a-zA-Z\\(\\)\\.,% ]{3,})?$","description":"主题格式：背景色-字体颜色。\n单独颜色值则为背景色且字体为黑色。"},"ztss":{"type":"array","items":{"type":"string","title":"主题","pattern":"^#?[0-9a-zA-Z\\(\\)\\.,% ]{3,}(-#?[0-9a-zA-Z\\(\\)\\.,% ]{3,})?$"},"title":"主题集"}},"required":["zhcz","zhdx","zhbj","djkh","cszt","ztss"]},"defaultConfig":{"zhdx":20,"zhcz":6,"zhbj":4,"djkh":true,"cszt":"#e3edcd","ztss":["#FFCBE8-#C71585","#fce4ec-#880e4f","#CCE2BF-green","#e0f2f1-#004d40","#e1f5fe-#01579b","#494949-#C1C1C1","#1a1c23-#c6c7c8","#000000-#bbbbbb","#C7EDCC","#DCECD2","#f4f0e9","#fff"]}}