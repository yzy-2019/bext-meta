{"type":"javascript","source":"/*\n * @name: 拼页\n * @Author: 酷安@达蒙山\n * @version: 220418.22\n * @description: 简单的手机网页拼接\n * @include: *\n */\n!function(a,b){\n\n const 使用说明=`\n\n需在屏幕从上到下、从右往左划出↙的手势，跨度大于屏幕尺寸1/3，呼出“拼页”按钮开关\n\n推荐脚本\n\n东方永页机 - 自动翻页脚本\nhttps://greasyfork.org/zh-CN/scripts/438684-pagetual-perpetual-pages\n\n页面自动拼接\nhttps://greasyfork.org/zh-CN/scripts/389621-%E9%A1%B5%E9%9D%A2%E8%87%AA%E5%8A%A8%E6%8B%BC%E6%8E%A5\n\nSuper_preloaderPlus_one_New\nhttps://greasyfork.org/zh-CN/scripts/436203-super-preloaderplus-one-new\n\n\n`;\n\n\tconst siteRules=[\n\t\t{\n\t\t\"name\":\"网站名称\",\n\t\t\"match\":/匹配url正则/,\n\t\t\"selector\":\"下一页所在a标签的选择器\",\n\t\t\"auto\":\"自动拼页0关1开\"\n\t},\n\t{\n\t\t\"name\":\"百度搜索\",\n\t\t\"match\":/(m|www)\\.baidu\\.com/,\n\t\t\"selector\":\"a[class^='new-nextpage']\",\n\t\t\"auto\":\"0\"\n\t}\n\t\t];\n\n\t\tlet aSelector=\"\";\n\t\tlet addPage=()=>{\n\n\t\tlet nextUrl=\"\";\n\t\tlet nowUrl;\n\t\tlet nextTitle;\n\t\tconst pageCoding=document.characterSet;\n\t\tconst cachePage=document.createElement(\"div\");\n\t\tcachePage.id=\"pinye-page\";\n\t\tcachePage.style.cssText=\"display:none!important;\";\n\t\tdocument.body.insertBefore(cachePage,document.body.firstChild);\n\n\t\tconst doRemove=e=>{while(null!=e.nextSibling){e.parentNode.removeChild(e.nextSibling)}};\n\n\t\tconst removeNextSibling=e=>{e.parentNode===document.querySelector(\"#pinye-page\")||e.parentNode===document.body?doRemove(e):(doRemove(e),removeNextSibling(e.parentNode))};\n\n\t\tconst doAdd=()=>{\n    nowUrl!=location.href&&history.pushState(null,nextTitle,nowUrl);\n    document.title=nextTitle;\n    document.body.innerHTML+=document.querySelector(\"#pinye-page\").innerHTML;\n    \"\"!=nextUrl?getHtml(nextUrl):nowUrl=\"\";\n    };\n\n\t\tconst getNextUrl=e=>{\n   if(aSelector!=\"\"){\n    let getA=e.querySelector(aSelector);\n    getA?(nextUrl=getA.href,removeNextSibling(getA.parentNode)):nextUrl=\"\";\n   }else{\n    let aTags=e.getElementsByTagName(\"a\");\n    let aTagsL=aTags.length;\n    const reg=/\\u4e0b.?(\\u9875|\\u9801|\\u8282|\\u7bc0|\\u7ae0|\\u7bc7|\\u5f20|\\u5f35|\\u5e45)|Next|>|\\u00bb|\\u2192/;\n    if(aTagsL>0){\n     for(let i=aTagsL-1;i>=0;i--){\n      let atag=aTags[i];\n      let aText=atag.innerText.trim().substr(0,5);\n      let aUrl=atag.href;\n      if(reg.test(aText)&&aUrl.indexOf(\"#\")==-1){\n       nextUrl=aUrl;\n       removeNextSibling(atag.parentNode);\n       break;\n      }else{\n      nextUrl=\"\";\n      }\n     }\n    }\n   }\n   };\n\n\t\tconst getHtml=url=>{\n   nowUrl=url;\n   let xhr=new XMLHttpRequest();\n   xhr.open(\"get\",url,true);\n   xhr.overrideMimeType(\"text/html;charset=\"+pageCoding);\n   let nextHtml=()=>{\n   if(4==xhr.readyState&&200==xhr.status){\n   document.querySelector(\"#pinye-page\").innerHTML=xhr.responseText.replace(/^\\s+|\\s+$/g,\"\").replace(/<!--.*?-->/g,\"\").replace(/>\\s+?</g,\"><\").replace(/<style[\\s\\S]*?<\\/style>/ig,\"\").replace(/<script[\\s\\S]*?<\\/script>/ig,\"\").replace(/<iframe[\\s\\S]*?<\\/iframe>/ig,\"\").match(/<body[\\s\\S]*<\\/body>/i);\n   nextTitle=xhr.responseText.match(/<title>([\\s\\S]*)<\\/title>/i)[1];\n   getNextUrl(document.querySelector(\"#pinye-page\"));\n   window.screen.height>=document.documentElement.scrollHeight&&doAdd();\n     }\n    }\n   xhr.onreadystatechange=nextHtml;\n   xhr.send();\n  }\n\n\t\tgetNextUrl(document);\n\t\tgetHtml(nextUrl);\n\t\tdocument.addEventListener(\"scroll\",()=>{\n    let e=document.documentElement.scrollTop||document.body.scrollTop;\n    nowUrl!=nextUrl&&e+window.screen.height>=document.documentElement.scrollHeight&&doAdd();\n});\n\n\t\t}\n\n/*匹配规则自动拼页*/\n\t\tfor(let i=0;i<siteRules.length;i++){\n\t\t\t\tif(location.href.match(siteRules[i].match)){\n\t\t\t\t\t\taSelector=siteRules[i].selector;\n\t\t\t\t\t\t\"1\"==siteRules[i].auto&&addPage();\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t}\n\n/*脚本悬浮触发开关*/\n\tif(!document.querySelector(\"#cdTools\")){let addDiv=document.createElement(\"div\");addDiv.id=\"cdTools\";addDiv.style.cssText=\"display:none;width:100%;position:fixed;bottom:0px;z-index:9999999999;text-align:center;margin:4px auto;padding:4px;-webkit-tap-highlight-color:rgba(0,0,0,0);\";document.body.appendChild(addDiv);let btnStyle=document.createElement(\"style\");btnStyle.innerHTML=\"#cdTools span{display:inline-block;background:#6a6a6a;color:#fff;font-size:20px;line-height:24px;margin:4px;padding:4px;border:1px solid #c5c5c5;border-radius:5px;}\";addDiv.appendChild(btnStyle);let movex=window.screen.width/3,movey=window.screen.height/3,movex1,movex2,movey1,movey2;document.addEventListener(\"touchstart\",e=>{movex1=e.changedTouches[0].clientX;movey1=e.changedTouches[0].clientY});document.addEventListener(\"touchmove\",e=>{movex2=e.changedTouches[0].clientX;movey2=e.changedTouches[0].clientY;addDiv.style.display=movex1-movex2>movex&&movey2-movey1>movey?\"block\":\"none\"})}\n\tif(!document.getElementById(a)){let cdDiv=document.querySelector(\"#cdTools\"),addBtn=document.createElement(\"span\");addBtn.id=a;addBtn.innerHTML=b;addBtn.addEventListener(\"click\",()=>{addPage();cdDiv.style.display=\"none\"});cdDiv.appendChild(addBtn)}\n\n}(\"jspinye\",\"\\u62fc\\u9875\");","name":"拼页","tags":["其他脚本"],"synopsis":"简单的手机网页拼接","version":"1","detail":"<p>使用说明</p><p><br></p><p>需在屏幕从上到下、从右往左划出↙的手势，跨度大于屏幕尺寸1/3，呼出“拼页”按钮开关</p><p><br></p><p><br></p><p>推荐脚本</p><p><br></p><p><a rel=\"noopener noreferrer\" href=\"https://greasyfork.org/zh-CN/scripts/438684-pagetual-perpetual-pages\">东方永页机 - 自动翻页脚本</a></p><p><br></p><p><a rel=\"noopener noreferrer\" href=\"https://greasyfork.org/zh-CN/scripts/389621-%E9%A1%B5%E9%9D%A2%E8%87%AA%E5%8A%A8%E6%8B%BC%E6%8E%A5\">页面自动拼接</a></p><p><br></p><p><a rel=\"noopener noreferrer\" href=\"https://greasyfork.org/zh-CN/scripts/436203-super-preloaderplus-one-new\">Super_preloaderPlus_one_New</a></p><p><br></p>"}