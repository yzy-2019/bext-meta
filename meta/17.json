{"type":"javascript","name":"划词菜单(搜索+翻译+保存+转到)","version":"2","synopsis":"划词搜索、划词翻译、保存选中文本、网址跳转","tags":["其他脚本"],"detail":"<p>更新：</p><ol><li>添加保存选中文本</li><li>优化功能</li></ol><p><br></p><p>支持添加多个搜索和翻译接口</p><p><br></p><p>【转到】划词包含多个网址默认跳转第一个</p><p><br></p>","source":"/*\n * @name: 划词菜单(搜索+翻译+保存+转到)\n * @Author: 酷安@达蒙山\n * @version: 220522.15\n * @description: 划词搜索、划词翻译、保存选中文本、网址跳转\n * @include: *\n */\nimport config from '@bext/config';\n!function() {\n\n  /*搜索引擎和翻译接口*/\n  const apis = config.apis;\n  \n  let swipesTimer,text='',\n\n  openUrl=(a,b=text)=>window.open(a+b),\n  \n  blobDownload=(content,filename='.txt')=>{\n    let alink=document.createElement('a');\n    alink.download=filename;\n    alink.style.display='none';\n    alink.href=URL.createObjectURL(new Blob([content]));\n    document.body.appendChild(alink);\n    alink.click();\n    document.body.removeChild(alink);\n  },\n\n  saveText=()=>{\n    let save = document.createElement(\"span\");\n    save.innerHTML = \"\\u4fdd\\u5b58\\u9009\\u4e2d\";\n    save.addEventListener(\"click\",function(){blobDownload(text)});\n    document.querySelector(\"#abcWords\").appendChild(save);\n    },\n\n  goTo=()=>{\n    let getUrl = text.match(/(https?:\\/\\/(\\w[\\w-]*\\.)+[A-Za-z]{2,5}(?!\\w)(:\\d+)?(\\/([\\x21-\\x7e]*[\\w\\/=])?)?|(\\w[\\w-]*\\.)+(com|cn|org|net|info|tv|cc|gov|edu)(?!\\w)(:\\d+)?(\\/([\\x21-\\x7e]*[\\w\\/=])?)?)/i)[0];\n    if (getUrl) {\n      let link = document.createElement(\"span\");\n      link.id = \"abcLink\";\n      link.innerHTML = \"\\u8f6c\\u5230\";\n      link.addEventListener(\"click\",function(){\n        -1==getUrl.indexOf(\"http\") ? openUrl(\"http://\", getUrl) : openUrl(\"\", getUrl);\n      });\n      document.querySelector(\"#abcWords\").appendChild(link);\n    }\n  },\n\n  main=()=>{\n    text = window.getSelection().toString().trim();    \n    text&&(document.querySelector(\"#abcWords\").style.display = \"block\",goTo());\n  },\n\n  swipes=()=>{\n    document.querySelector(\"#abcWords\").style.display = \"none\";\n    document.querySelector(\"#abcLink\")&&document.querySelector(\"#abcLink\").remove();\n    clearTimeout(swipesTimer);\n    swipesTimer = setTimeout(main, 750);\n  }\n\n  if (!document.querySelector(\"#abcWords\")) {\n    let adDiv = document.createElement(\"div\");\n    adDiv.id = \"abcWords\";\n    adDiv.style.cssText = \"display:none;width:100%;position:fixed;bottom:0px;z-index:9999999999;text-align:center;margin:4px auto;padding:4px;-webkit-tap-highlight-color:rgba(0,0,0,0);\";\n    document.body.appendChild(adDiv);\n    let spanStyle = document.createElement(\"style\");\n    spanStyle.innerHTML = \"#abcWords span{display:inline-block!important;background:#6a6a6a;color:#fff;font-size:20px;line-height:24px;margin:4px;padding:4px;border:1px solid #c5c5c5;border-radius:5px;}\";\n    document.body.appendChild(spanStyle);\n\n    apis.forEach(i=>{\n      let addApi = document.createElement(\"span\");\n      addApi.innerHTML = i.name;\n      addApi.setAttribute(\"data-api\", i.api);\n      addApi.onclick = function(){\n        openUrl(this.getAttribute(\"data-api\"));\n      };\n      document.querySelector(\"#abcWords\").appendChild(addApi);\n    });\n    \n    saveText();\n\n  }\n\n  document.addEventListener(\"selectionchange\", swipes);\n\n}();","configSchema":{"type":"object","properties":{"apis":{"type":"array","items":{"type":"object","properties":{"name":{"type":"string","title":"名称"},"api":{"type":"string","title":"地址","format":"uri"}},"required":["name","api"]},"title":"搜索引擎"}},"required":[]},"defaultConfig":{"apis":[{"name":"百度搜索","api":"https://www.baidu.com/s?wd="},{"name":"夸克搜索","api":"https://quark.sm.cn/s?q="},{"name":"百度翻译","api":"https://fanyi.baidu.com/?tpltype=sigma#zd/zd/"},{"name":"谷歌翻译","api":"https://translate.google.cn/?sl=auto&tl=auto&op=translate&text="}]}}